<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.promanage.service.mapper.ProjectMapper">

    <!-- 根据负责人ID查找项目列表 -->
    <select id="findByOwnerId" resultType="com.promanage.service.entity.Project">
        SELECT * FROM tb_project
        WHERE owner_id = #{ownerId}
        AND deleted = false
        ORDER BY update_time DESC
    </select>

    <!-- 根据成员ID查找项目列表 -->
    <select id="findByMemberId" resultType="com.promanage.service.entity.Project">
        SELECT p.* FROM tb_project p
        INNER JOIN tb_project_member pm ON p.id = pm.project_id
        WHERE pm.user_id = #{userId}
        AND pm.status = 0
        AND p.deleted = false
        ORDER BY p.update_time DESC
    </select>

    <!-- 根据项目编码查找项目 -->
    <select id="findByCode" resultType="com.promanage.service.entity.Project">
        SELECT * FROM tb_project
        WHERE code = #{code}
        AND deleted = false
    </select>

    <!-- 根据状态查找项目列表 -->
    <select id="findByStatus" resultType="com.promanage.service.entity.Project">
        SELECT * FROM tb_project
        WHERE status = #{status}
        AND deleted = false
        ORDER BY update_time DESC
    </select>

    <!-- 检查项目编码是否存在 -->
    <select id="existsByCode" resultType="boolean">
        SELECT COUNT(*) > 0 FROM tb_project
        WHERE code = #{code}
        AND deleted = false
    </select>

</mapper>